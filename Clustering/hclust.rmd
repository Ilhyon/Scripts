---
title: 'rG4 : hierarchical clustering'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Import of library

```{r}
#install.packages("stringi")
library("stringi")
#source("http://bioconductor.org/biocLite.R")
#biocLite("Biostrings")
library("Biostrings")
```

## Data processing

First we import the data of our G4.

```{r}
MM_All_G4InTranscript_Unique <- read.delim("~/Documents/Data/Mouse/All/MM_All_G4InTranscript_Unique.txt", row.names=1) # import of data
```

Then we compute the matrix with k-mer (here k = 3).

```{r}
fbio <- function(x){
    t(sapply(x, function(x){x1 <-  DNAString(x); oligonucleotideFrequency(x1,3)}))
}

DNAlst = MM_All_G4InTranscript_Unique$sequenceG4[1:100] # geting a subset of the data to test
name = rownames(MM_All_G4InTranscript_Unique)[1:100] # retrieve of the name of our data
kmer_matrix = fbio(DNAlst) # compute the matrix of k-mer
rownames(kmer_matrix) = name # add labels on the matrix
```

Now that we have the matrix of count for each k-mer in the rG4, we will normalise it by the length of the rG4. Like this, we could then compare result for rG4 with different length.

```{r}
rG4_string = MM_All_G4InTranscript_Unique$sequenceG4[1:100] # retrieve of the rG4 sequence
for(i in c(1:100)){ # loop to browse all sequence and convert it to character
  rG4_string[i] = as.character(rG4_string[i])
}
rG4_length = stri_length(rG4_string) # creqte a vector with the length of each rG4 sequences

normalized_kmer_matrix = kmer_matrix / rG4_length # normalisation by the length

d = dist(normalized_kmer_matrix, method = "euclidean")
```

## Clustering

At this point, we get our matrix of k-mer and we even normalised it in function of the length of sequences. It is time to do the clustering !

```{r}
dendro = hclust(d, method = 'ward.D')
plot(dendro, hang = -1) # hang pour l'axe commence Ã  zero
heatmap(as.dendro(dendro))
```













